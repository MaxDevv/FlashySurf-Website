<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview & Download Collection | FlashySurf</title>
    <meta name="description"" id="meta-description" content="Study and learn easily using FlashySurf to supercharge your passive learning and Study without Ever Studying.">
    <link rel="stylesheet" href="/styles.css">
    <meta charset="utf-8">

    <style>
        /* Custom styles for the collection download page */
        .collection-header {
            padding-top: 10rem;
            padding-bottom: 3rem;
            text-align: center;
        }

        .collection-header p {
            margin: 1rem auto 0;
            color: var(--color-text-light);
            font-size: 1.25rem;
            max-width: 42rem;
        }

        .collection-container {
            padding-bottom: 5rem;
        }

        .collection-details {
            background-color: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            padding: 3rem 3.5rem;
            box-shadow: var(--shadow-lg);
            max-width: 50rem;
            margin: 0 auto;
        }

        .collection-details h2 {
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            color: var(--color-primary);
            font-size: 1.75rem;
            border-bottom: 2px solid #f3f4f6;
            padding-bottom: 0.75rem;
        }

        .collection-details h2:first-of-type {
            margin-top: 0;
        }

        .collection-details h3 {
            margin-top: 2.5rem;
            margin-bottom: 1.25rem;
            color: var(--color-text-dark);
            font-size: 1.35rem;
            font-weight: 600;
        }

        .collection-details p {
            margin-bottom: 1.5rem;
            line-height: 1.7;
            font-size: 1.05rem;
        }

        .collection-details ol {
            list-style: none;
            padding-left: 0;
            margin-bottom: 1.5rem;
            counter-reset: step-counter;
        }

        .collection-details li {
            counter-increment: step-counter;
            margin-bottom: 1.5rem;
            padding-left: 45px;
            position: relative;
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .collection-details li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: -2px;
            color: var(--color-white);
            background-color: var(--color-primary);
            font-weight: bold;
            font-size: 1rem;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .collection-details strong {
            font-weight: 600;
            color: var(--color-text-dark);
        }

        .instructions-box {
            background-color: #f9fafb;
            border-left: 4px solid var(--color-primary);
            padding: 1.5rem 2rem;
            margin: 2rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        .instructions-box p {
            margin-bottom: 0;
        }

        .collection-details img {
            border-radius: 0.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-border);
            margin-top: 1rem;
            max-width: 100%;
        }

        /* Added a style for the download button */
        .btn-download {
            display: block;
            width: 100%;
            text-align: center;
            padding: 1rem;
            font-size: 1.2rem;
            margin-bottom: 2rem;
            background-color: var(--color-primary);
            color: var(--color-white);
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .btn-download:hover {
            background-color: #0056b3; /* Darker shade of your primary color */
        }

        /* Flashcard Preview Section Styles */
        .flashcard-preview-section {
            background-color: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            padding: 3rem 3.5rem;
            box-shadow: var(--shadow-lg);
            margin-top: 3rem;
            margin-bottom: 2rem;
            max-width: 50vw;
            justify-self: center;
        }

        .flashcard-preview-section h3 {
            margin-bottom: 1.5rem;
            color: var(--color-primary);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .flashcard-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
            background-color: #f9fafb;
            border: 1px solid var(--color-border);
        }

        .flashcard-scroll-wrapper {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 1rem;
            gap: 1rem;
            scrollbar-color: var(--color-primary) #f1f1f1;
        }

        .flashcard-scroll-wrapper::-webkit-scrollbar {
            height: 16px;
        }

        .flashcard-scroll-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .flashcard-scroll-wrapper::-webkit-scrollbar-thumb {
            background: var(--color-primary);
            border-radius: 4px;
        }

        .flashcard {
            min-width: 350px;
            background-color: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .flashcard:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .flashcard-question {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-text-dark);
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .flashcard-choices {
            list-style: none;
            padding: 0;
            margin-bottom: 1rem;
        }

        .flashcard-choices li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #f3f4f6;
            position: relative;
            padding-left: 1.5rem;
        }

        .flashcard-choices li:last-child {
            border-bottom: none;
        }

        .flashcard-choices li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0.775rem;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            border: 2px solid #d1d5db;
        }

        .flashcard-choices li.correct::before {
            background-color: #10b981;
            border-color: #10b981;
        }

        .flashcard-choices li.correct::after {
            content: '✓';
            position: absolute;
            left: 0.25rem;
            top: 0.775rem;
            color: white;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .flashcard-explanation {
            background-color: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            border-radius: 0 0.25rem 0.25rem 0;
            font-size: 0.95rem;
            color: var(--color-text-dark);
            line-height: 1.5;

        }
        .flashcard-explanation::before {
            content: "Explanation: ";
        }

        .flashcard-paragraph {
            background-color: #f9fafb;
            border-left: 4px solid #6b7280;
            padding: 1rem;
            border-radius: 0 0.25rem 0.25rem 0;
            font-size: 0.95rem;
            color: var(--color-text-dark);
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .no-flashcards {
            text-align: center;
            padding: 2rem;
            color: var(--color-text-light);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .collection-header {
                padding-top: 6rem;
                padding-bottom: 2rem;
            }
            
            .collection-header p {
                font-size: 1.1rem;
                max-width: 100%;
                padding: 0 1rem;
            }
            
            .collection-container {
                padding-bottom: 3rem;
            }
            
            .collection-details {
                padding: 2rem 1.5rem;
                max-width: 100%;
                margin: 0 1rem;
            }
            
            .flashcard-preview-section {
                padding: 2rem 1.5rem;
                margin: 2rem 1rem;
                max-width: 100%;
            }
            
            .flashcard {
                min-width: 280px;
                max-width: 300px;
                padding: 1rem;
            }
            
            .flashcard-question {
                font-size: 1rem;
                line-height: 1.3;
            }
            
            .flashcard-choices li {
                font-size: 0.95rem;
                /* padding: 0.4rem 0; */
            }
            
            .flashcard-explanation,
            .flashcard-paragraph {
                font-size: 0.9rem;
                padding: 0.75rem;
            }
            
            .collection-details h2 {
                font-size: 1.5rem;
                margin-top: 2rem;
                margin-bottom: 1rem;
            }
            
            .collection-details h3 {
                font-size: 1.25rem;
                margin-top: 2rem;
                margin-bottom: 1rem;
            }
            
            .collection-details p {
                font-size: 1rem;
                line-height: 1.6;
                margin-bottom: 1.25rem;
            }
            
            .instructions-box {
                padding: 1.25rem 1.5rem;
                margin: 1.5rem 0;
            }
            
            .btn-download {
                padding: 0.875rem;
                font-size: 1.1rem;
                margin-bottom: 1.5rem;
            }
            
            /* Ensure header navigation works well on mobile */
            .main-nav {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            /* Touch-friendly scrolling for flashcards */
            .flashcard-scroll-wrapper {
                -webkit-overflow-scrolling: touch;
                scroll-snap-type: x mandatory;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .flashcard-scroll-wrapper::-webkit-scrollbar {
                display: none;
            }
            
            .flashcard {
                scroll-snap-align: start;
            }
            
            /* Prevent horizontal scroll on mobile */
            html, body {
                overflow-x: hidden;
            }
        }
        
        @media (min-width: 769px) {
            .main-nav {
                display: flex;
            }
            
            .mobile-menu-btn {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .flashcard {
                min-width: 250px;
                max-width: 280px;
                padding: 0.875rem;
            }
            
            .flashcard-preview-section {
                padding: 1.5rem 1rem;
                margin: 1rem;
            }
            
            .collection-details {
                padding: 1.5rem 1rem;
                margin: 0 0.5rem;
            }
            
            .collection-header {
                padding-top: 5rem;
                padding-bottom: 1.5rem;
            }
            
            .btn-download {
                padding: 0.75rem;
                font-size: 1rem;
                margin-bottom: 1rem;
            }
        }
        
        /* Mobile menu button styles */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            color: var(--color-text-dark);
        }

        .mobile-menu-btn svg {
            width: 24px;
            height: 24px;
        }

        /* Accessibility improvements */
        .btn-download {
            display: block;
            width: 100%;
            text-align: center;
            padding: 1rem;
            font-size: 1.2rem;
            margin-bottom: 2rem;
            background-color: var(--color-primary);
            color: var(--color-white);
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-download:hover {
            background-color: #0056b3;
        }

        .btn-download:focus {
            outline: 3px solid rgba(59, 130, 246, 0.5);
            outline-offset: 2px;
        }
    </style>
</head>

<body>

    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="header-logo"><img src="/media/Logo.png"
                        alt="FlashySurf Logo"><span>FlashySurf</span></a>
                <nav class="main-nav">
                    <a href="/">Home</a>
                    <a href="/updates">Updates &amp; Changes</a>
                    <a href="/onboarding">Help &amp; Onboarding</a>
                    <a href="/creator">Creator</a>
                </nav>
                <div class="header-cta">
                    <a href="https://chromewebstore.google.com/detail/ldajenfdgimgdajklkohhljdgdalcedb?utm_source=item-share-website"
                        target="_blank" rel="noopener" class="btn btn-primary btn-sm">Add to Chrome</a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="collection-header">
            <div class="container">
                <div class="mx-auto" style="max-width: 48rem;">
                    <h1 id="collection-title">Loading Collection...</h1>
                    <p id="collection-description">Please wait while we fetch the details for this flashcard deck.</p>
                </div>
            </div>
        </section>

            <!-- Flashcard Preview Section -->
            <div class="flashcard-preview-section">
                <h3>Preview Flashcards</h3>
                <div class="flashcard-container">
                    <div id="flashcard-scroll-wrapper" class="flashcard-scroll-wrapper">
                        <!-- Flashcards will be dynamically inserted here -->
                        <div class="no-flashcards">Loading flashcard preview...</div>
                    </div>
                </div>
            </div>
        <section class="collection-container">
            <div class="container">
                <div id="collection-content-wrapper" class="collection-details" style="display: none;">
                    
                    <h2>How to Use This Deck :D</h2>

                    <div class="instructions-box">
                        <h3>Follow these 3 steps to start learning passively:</h3>
                        <ol>
                            <li>
                                <strong>Download the Deck</strong>:
                                Click the big download button below to get the collection file.
                            </li>
                            <li>
                                <strong>Get FlashySurf</strong>:
                                If you haven't already, install the free FlashySurf extension from the Chrome Web Store.
                            </li>
                            <li>
                                <strong>Import into FlashySurf</strong>:
                                Open the extension, click "Add/Update/Edit Flashcard Collection", and then drag the downloaded file into the import area.
                                <img src="/media/import-flashcards-collection-to-extension.gif" alt="A GIF showing how to drag and drop a collection file into the FlashySurf import interface.">
                            </li>
                        </ol>
                    </div>

                <a href="#" class="btn-download">Download</a>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <!-- Your footer content remains the same -->
        <div class="container">
            <div class="footer-content">
                <a href="/" class="footer-logo"><img src="/media/Logo.png" alt="FlashySurf Logo"><span>© 2025
                        FlashySurf. All rights reserved.</span></a>
                <div class="social-links">
                    <a href="https://github.com/MaxDevv/FlashySurf" aria-label="GitHub" target="_blank"
                        rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                            fill="currentColor" viewBox="0 0 16 16">
                            <path
                                d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z">
                            </path>
                        </svg></a>
                </div>
            </div>
        </div>
    </footer>
</body>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- 1. Get Elements ---
        const titleElement = document.getElementById('collection-title');
        const descriptionElement = document.getElementById('collection-description');
        const contentWrapper = document.getElementById('collection-content-wrapper');
        const downloadButton = document.querySelector('.btn-download'); // Select the button that's already in the HTML

        // --- 2. Get Collection ID from URL ---
        const params = new URLSearchParams(window.location.search);
        const collectionId = params.get('collectionId') ? params.get('collectionId') : new URL(window.location.href).pathname.split("/")[2];

        if (!collectionId) {
            titleElement.textContent = 'Collection Not Found';
            descriptionElement.textContent = 'Please check the URL and make sure it contains a valid collection ID.';
            return; // Stop the script if no ID is found
        }

        // Pseudo Title for google seo
        let pseudoTitle = new URL(window.location.href).pathname.split("/")[3].replace("-", " ");
        document.title = `${pseudoTitle} Flashcards | FlashySurf Collection`
        document.querySelector('#meta-description').setAttribute('content', `Study and learn "${pseudoTitle}" easily using FlashySurf to supercharge your passive learning and Study without Ever Studying.`);
        

        // --- 3. Fetch Collection Data from API ---
        fetch("https://add-retreive-collection-1085676987010.europe-west1.run.app",  {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					id: collectionId
				})
			}).then(response => {
                if (!response.ok) {
                    // Handle HTTP errors like 404 or 500
                    throw new Error(`API responded with status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                const { title, description, collection } = data;

                // --- 4. Populate Page with Fetched Data ---
                document.title = `${title} Flashcards | FlashySurf Collection`;
                titleElement.textContent = title;
                descriptionElement.textContent = description;
                document.querySelector('#meta-description').setAttribute('content', `Study and learn "${title}" easily using FlashySurf to supercharge your passive learning and Study without Ever Studying.`);
        
                // --- 5. Set up the Download Button ---
                setupDownloadButton(title, collection);

                // --- 6. Render Flashcard Preview ---
                renderFlashcardPreview(collection);

                // Show the main content block now that data is loaded
                contentWrapper.style.display = 'block';
            })
            .catch(error => {
                // --- 6. Handle Errors ---
                
                console.error('Error fetching collection:', error);
                titleElement.textContent = 'Error Loading Collection';
                descriptionElement.textContent = 'Could not load the flashcard deck. Please try again later or contact support.';
            });

        // --- Helper function to configure the download button ---
        function setupDownloadButton(title, collectionData) {
            if (!downloadButton) return; // Safety check

            downloadButton.textContent = `Download "${title}" Deck`;
            
            downloadButton.addEventListener('click', (event) => {
                event.preventDefault();

                const jsonString = JSON.stringify(collectionData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Create a filename like "japanese-hiragana-deck.flashysurfcollection.json"
                const fileName = `${title.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-')}.flashysurfcollection.json`;

                // Create a temporary link element to trigger the download
                const tempLink = document.createElement('a');
                tempLink.href = url;
                tempLink.setAttribute('download', fileName);
                document.body.appendChild(tempLink);
                tempLink.click();

                // Clean up the temporary elements
                document.body.removeChild(tempLink);
                URL.revokeObjectURL(url);
            });
        }

        // --- Helper function to render flashcard preview ---
        function renderFlashcardPreview(collectionData) {
            const flashcardWrapper = document.getElementById('flashcard-scroll-wrapper');
            
            // Clear the loading message
            flashcardWrapper.innerHTML = '';
            
            if (!collectionData || !collectionData.questions || collectionData.questions.length === 0) {
                flashcardWrapper.innerHTML = '<div class="no-flashcards">No flashcards available for preview.</div>';
                return;
            }

            // Create flashcard elements for each question
            collectionData.questions.forEach((question, index) => {
                const flashcard = document.createElement('div');
                flashcard.className = 'flashcard';
                
                // Create question section
                const questionDiv = document.createElement('div');
                questionDiv.className = 'flashcard-question';
                questionDiv.textContent = question.question;
                flashcard.appendChild(questionDiv);

                // Create paragraph section if available
                if (question.paragraph) {
                    const paragraphDiv = document.createElement('div');
                    paragraphDiv.className = 'flashcard-paragraph';
                    paragraphDiv.textContent = question.paragraph;
                    flashcard.appendChild(paragraphDiv);
                }

                // Create choices section
                if (question.choices && question.choices.length > 0) {
                    const choicesList = document.createElement('ul');
                    choicesList.className = 'flashcard-choices';
                    
                    question.choices.forEach((choice, choiceIndex) => {
                        const choiceItem = document.createElement('li');
                        choiceItem.textContent = choice;
                        
                        // Mark the correct choice
                        if (question.answer && question.answer.includes(choice)) {
                            choiceItem.classList.add('correct');
                        }
                        
                        choicesList.appendChild(choiceItem);
                    });
                    
                    flashcard.appendChild(choicesList);
                }

                // Create explanation section if available
                if (question.explanation) {
                    const explanationDiv = document.createElement('div');
                    explanationDiv.className = 'flashcard-explanation';
                    explanationDiv.textContent = question.explanation;
                    flashcard.appendChild(explanationDiv);
                }

                flashcardWrapper.appendChild(flashcard);
            });
        }
    });
</script>
</html>